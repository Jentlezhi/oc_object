<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.2.1 (458835)"/><meta name="author" content="juntaozhi@163.com"/><meta name="created" content="2019-11-25 09:39:04 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-11-27 09:52:18 +0000"/><meta name="content-class" content="yinxiang.markdown"/><title>15. Runtime</title></head><body><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">一、 Runtime简介</h4>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">Objective-C是一门动态性比较强的编程语言，跟C、C++等语言有着很大的不同</p>
</li>
<li style="line-height: 160%; box-sizing: content-box;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">Objective-C的动态性是由Runtime API来支撑的</p>
</li>
<li style="line-height: 160%; box-sizing: content-box;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">Runtime API提供的接口基本都是C语言的，源码由C\C++\汇编语言编写</p>
</li>
</ol>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">二、 isa详解</h4>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">2.1 介绍</h5>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">要想学习Runtime，首先要了解它底层的一些常用数据结构，比如isa指针</p>
</li>
<li style="line-height: 160%; box-sizing: content-box;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在arm64架构之前，isa就是一个普通的指针，存储着Class、Meta-Class对象的内存地址</p>
</li>
<li style="line-height: 160%; box-sizing: content-box;">
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">从arm64架构开始，对isa进行了优化，变成了一个共用体（union）结构，还使用位域来存储更多的信息</p>
</li>
</ol>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">2.2 位域</h5>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><a href="https://juejin.im/post/5ce1324af265da1b8f1a9162" style="line-height: 160%; box-sizing: content-box; text-decoration: underline; color: #5286bc;">位运算世界畅游指南</a></p>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">按位与（&amp;）
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">运算规则：0&amp;0=0;   0&amp;1=0;    1&amp;0=0;     1&amp;1=1;<br/>
即：两位同时为“1”，结果才为“1”，否则为0<br/>
例如：3&amp;5  即 0000 0011 &amp; 0000 0101 = 0000 0001   因此，3&amp;5的值得1。</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">“与运算”的特殊用途：<br/>
（1）清零。如果想将一个单元清零，即使其全部二进制位为0，只要与一个各位都为零的数值相与，结果为零。<br/>
（2）取一个数中指定位<br/>
方法：找一个数，对应X要取的位，该数的对应位为1，其余位为零，此数与X进行“与运算”可以得到X中的指定位。<br/>
例：设X=10101110，<br/>
取X的低4位，用 X & 0000 1111 = 0000 1110&nbsp;&nbsp;即可得到；<br/>
还可用来取X的2、4、6位。</li>
</ul>
</li>
<li style="line-height: 160%; box-sizing: content-box;">位域<br/>
拓展：双感叹号（！！）<br/>
因为C语言中，所有非0值都表示“真”。所以!非0值 = 0，而!0 = 1。双感叹号!!作用就是非0值转成1，而0值还是0.双感叹号!!是为了把"非0值"转换成1，而0值还是0。!!不难理解，举例：<br/>
!!(expression) 等价于!(!expression)。如果express是一个指针，最终结果就是1.这样!!(expression)可以给bool变量赋值了。</li>
</ol>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">如果程序的结构中包含多个开关量，只有 TRUE/FALSE 变量，如下：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">struct
{
  unsigned int widthValidated;
  unsigned int heightValidated;
} status;
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">这种结构需要 8 字节的内存空间，但在实际上，在每个变量中，我们只存储 0 或 1。在这种情况下，C 语言提供了一种更好的利用内存空间的方式。如果您在结构内使用这样的变量，您可以定义变量的宽度来告诉编译器，您将只使用这些字节。例如，上面的结构可以重写成：<br/>
struct<br/>
{<br/>
unsigned int widthValidated : 1;<br/>
unsigned int heightValidated : 1;<br/>
} status;</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在结构内声明位域的形式如下：<br/>
struct<br/>
{<br/>
type [member_name] : width ;<br/>
};</p>
<table style="margin: 2px 0 14px; color: #333; width: auto; border-collapse: collapse; box-sizing: border-box;"><thead style="line-height: 160%; box-sizing: content-box;"><tr style="line-height: 160%; box-sizing: content-box;"><th style="line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;">元素</th><th style="line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #72777b; border-top: 0; background-color: #7b8184; font-weight: 300; color: #fff; padding-top: 6px;">描述</th></tr></thead><tbody style="line-height: 160%; box-sizing: content-box;"><tr style="line-height: 160%; box-sizing: content-box;"><td style="line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">type</td><td style="line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">整数类型，决定了如何解释位域的值。类型可以是整型、有符号整型、无符号整型。</td></tr><tr style="line-height: 160%; box-sizing: content-box;"><td style="line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">member_name</td><td style="line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">位域的名称。</td></tr><tr style="line-height: 160%; box-sizing: content-box;"><td style="line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">width</td><td style="line-height: 160%; box-sizing: content-box;  padding: 5px 14px 5px 12px; border: 1px solid #eaeaea;">位域中位的数量。宽度必须小于或等于指定类型的位宽度。</td></tr></tbody></table>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">带有预定义宽度的变量被称为位域。位域可以存储多于 1 位的数，例如，需要一个变量来存储从 0 到 7 的值，您可以定义一个宽度为 3 位的位域，如下：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">struct
{
  unsigned int age : 3;
} Age;
</code></pre>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">2.3 ISA_MASK</h5>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">0x 0000 000f ffff fff8 ULL<br/>
<img src="15.%20Runtime.resources/Snip20191127_12.png" height="996" width="2812"/><br/>
isa指针不单单只存储了Class或Meta-Class的地址，而是使用共用体的方式存储了更多信息，其中shiftcls存储了Class或Meta-Class的地址，需要同ISA_MASK进行按位&amp;运算才可以取出其内存地址值。</p>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">2.4 位运算在枚举中的运用</h5>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="15.%20Runtime.resources/Snip20191127_13.png" height="392" width="1040"/><br/>
<img src="15.%20Runtime.resources/Snip20191127_16.png" height="770" width="1204"/><br/>
<img src="15.%20Runtime.resources/Snip20191127_14.png" height="646" width="742"/></p>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">2.5 字符串编码</h5>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">iOS中提供了一个叫做@encode的指令，可以将具体的类型表示成字符串编码</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="15.%20Runtime.resources/Snip20191127_17.png" height="770" width="1806"/></p>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">2.6 方法缓存</h5>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">oc方法的调用：根据isa指针找到类对象的方法列表，若找到，则开始调用。若未找到，则根据suprerClass指针找到父类对象的方法列表，开始调用，以此类推。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">Class内部结构中有个方法缓存（cache_t），用散列表（哈希表）来缓存曾经调用过的方法，可以提高方法的查找速度。<br/>
1、散列表<br/>
散列表（Hash table，也叫哈希表), 是根据关键码值(Key value)而直接进行访问的数据结构。也就是说，它通过把关键码值映射到表中一个位置来访问记录,以加快查找的速度。这个映射函数叫做散列函数,存放记录的数组叫做散列表。<br/>
2、OC方法缓存<br/>
<img src="15.%20Runtime.resources/Snip20191127_18.png" height="1302" width="2036"/><br/>
<img src="15.%20Runtime.resources/Snip20191127_19.png" height="1336" width="1954"/><br/>
3、散列表原理<br/>
首先生成一个空的数组如下图:<br/>
<img src="15.%20Runtime.resources/Snip20191127_20.png" height="540" width="1352"/></p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">比如我们有一个方法
- (void)cacheMethd {
}

key = @selector(cacheMethd) // 方法名
_mask                                          //  常量
index = @selector(cacheMethd) &amp; _mask;
算出来比如说index = 2
存取数据都是通过算出数组下标  来存储或者获取数据
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;"><img src="15.%20Runtime.resources/Snip20191127_21.png" height="546" width="1368"/></p>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">哈希冲突</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">// 存数据
如果index = @selector(cacheMethd) &amp; _mask;
算出来的index已经存在数据

while(bucket[index]) {
       index --;
       if(index &lt; 0) {
            index = 数组count - 1;
        }
}

// 取数据
算出index = @selector(cacheMethd) &amp; _mask;
取出bucket_t

对比key是否相等
相等直接返回
不等
while(bucket[index]) {
       index --;
       if(index &lt; 0) {
            index = 数组count - 1;
        }
}
继续判duan'k

</code></pre>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%20%23%23%23%23%20%E4%B8%80%E3%80%81%20Runtime%E7%AE%80%E4%BB%8B%0A%20%0A%0A1.%20Objective-C%E6%98%AF%E4%B8%80%E9%97%A8%E5%8A%A8%E6%80%81%E6%80%A7%E6%AF%94%E8%BE%83%E5%BC%BA%E7%9A%84%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%EF%BC%8C%E8%B7%9FC%E3%80%81C%2B%2B%E7%AD%89%E8%AF%AD%E8%A8%80%E6%9C%89%E7%9D%80%E5%BE%88%E5%A4%A7%E7%9A%84%E4%B8%8D%E5%90%8C%0A%0A2.%20Objective-C%E7%9A%84%E5%8A%A8%E6%80%81%E6%80%A7%E6%98%AF%E7%94%B1Runtime%20API%E6%9D%A5%E6%94%AF%E6%92%91%E7%9A%84%0A%0A3.%20Runtime%20API%E6%8F%90%E4%BE%9B%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%9F%BA%E6%9C%AC%E9%83%BD%E6%98%AFC%E8%AF%AD%E8%A8%80%E7%9A%84%EF%BC%8C%E6%BA%90%E7%A0%81%E7%94%B1C%5CC%2B%2B%5C%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E7%BC%96%E5%86%99%0A%0A%23%23%23%23%20%E4%BA%8C%E3%80%81%20isa%E8%AF%A6%E8%A7%A3%0A%0A%23%23%23%23%23%202.1%20%E4%BB%8B%E7%BB%8D%0A1.%20%E8%A6%81%E6%83%B3%E5%AD%A6%E4%B9%A0Runtime%EF%BC%8C%E9%A6%96%E5%85%88%E8%A6%81%E4%BA%86%E8%A7%A3%E5%AE%83%E5%BA%95%E5%B1%82%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%8C%E6%AF%94%E5%A6%82isa%E6%8C%87%E9%92%88%0A%0A2.%20%E5%9C%A8arm64%E6%9E%B6%E6%9E%84%E4%B9%8B%E5%89%8D%EF%BC%8Cisa%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E6%99%AE%E9%80%9A%E7%9A%84%E6%8C%87%E9%92%88%EF%BC%8C%E5%AD%98%E5%82%A8%E7%9D%80Class%E3%80%81Meta-Class%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%86%85%E5%AD%98%E5%9C%B0%E5%9D%80%0A%0A3.%20%E4%BB%8Earm64%E6%9E%B6%E6%9E%84%E5%BC%80%E5%A7%8B%EF%BC%8C%E5%AF%B9isa%E8%BF%9B%E8%A1%8C%E4%BA%86%E4%BC%98%E5%8C%96%EF%BC%8C%E5%8F%98%E6%88%90%E4%BA%86%E4%B8%80%E4%B8%AA%E5%85%B1%E7%94%A8%E4%BD%93%EF%BC%88union%EF%BC%89%E7%BB%93%E6%9E%84%EF%BC%8C%E8%BF%98%E4%BD%BF%E7%94%A8%E4%BD%8D%E5%9F%9F%E6%9D%A5%E5%AD%98%E5%82%A8%E6%9B%B4%E5%A4%9A%E7%9A%84%E4%BF%A1%E6%81%AF%0A%0A%23%23%23%23%23%202.2%20%E4%BD%8D%E5%9F%9F%0A%0A%5B%E4%BD%8D%E8%BF%90%E7%AE%97%E4%B8%96%E7%95%8C%E7%95%85%E6%B8%B8%E6%8C%87%E5%8D%97%5D(https%3A%2F%2Fjuejin.im%2Fpost%2F5ce1324af265da1b8f1a9162)%0A1.%20%E6%8C%89%E4%BD%8D%E4%B8%8E%EF%BC%88%26%EF%BC%89%0A%20%20%20*%20%E8%BF%90%E7%AE%97%E8%A7%84%E5%88%99%EF%BC%9A0%260%3D0%3B%20%20%200%261%3D0%3B%20%20%20%201%260%3D0%3B%20%20%20%20%201%261%3D1%3B%0A%20%20%E5%8D%B3%EF%BC%9A%E4%B8%A4%E4%BD%8D%E5%90%8C%E6%97%B6%E4%B8%BA%E2%80%9C1%E2%80%9D%EF%BC%8C%E7%BB%93%E6%9E%9C%E6%89%8D%E4%B8%BA%E2%80%9C1%E2%80%9D%EF%BC%8C%E5%90%A6%E5%88%99%E4%B8%BA0%0A%20%20%E4%BE%8B%E5%A6%82%EF%BC%9A3%265%20%20%E5%8D%B3%200000%200011%20%26%200000%200101%20%3D%200000%200001%20%20%20%E5%9B%A0%E6%AD%A4%EF%BC%8C3%265%E7%9A%84%E5%80%BC%E5%BE%971%E3%80%82%0A%20%20%20*%20%E2%80%9C%E4%B8%8E%E8%BF%90%E7%AE%97%E2%80%9D%E7%9A%84%E7%89%B9%E6%AE%8A%E7%94%A8%E9%80%94%EF%BC%9A%0A%20%20%20%EF%BC%881%EF%BC%89%E6%B8%85%E9%9B%B6%E3%80%82%E5%A6%82%E6%9E%9C%E6%83%B3%E5%B0%86%E4%B8%80%E4%B8%AA%E5%8D%95%E5%85%83%E6%B8%85%E9%9B%B6%EF%BC%8C%E5%8D%B3%E4%BD%BF%E5%85%B6%E5%85%A8%E9%83%A8%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%BD%8D%E4%B8%BA0%EF%BC%8C%E5%8F%AA%E8%A6%81%E4%B8%8E%E4%B8%80%E4%B8%AA%E5%90%84%E4%BD%8D%E9%83%BD%E4%B8%BA%E9%9B%B6%E7%9A%84%E6%95%B0%E5%80%BC%E7%9B%B8%E4%B8%8E%EF%BC%8C%E7%BB%93%E6%9E%9C%E4%B8%BA%E9%9B%B6%E3%80%82%0A%20%20%20%EF%BC%882%EF%BC%89%E5%8F%96%E4%B8%80%E4%B8%AA%E6%95%B0%E4%B8%AD%E6%8C%87%E5%AE%9A%E4%BD%8D%0A%20%20%20%E6%96%B9%E6%B3%95%EF%BC%9A%E6%89%BE%E4%B8%80%E4%B8%AA%E6%95%B0%EF%BC%8C%E5%AF%B9%E5%BA%94X%E8%A6%81%E5%8F%96%E7%9A%84%E4%BD%8D%EF%BC%8C%E8%AF%A5%E6%95%B0%E7%9A%84%E5%AF%B9%E5%BA%94%E4%BD%8D%E4%B8%BA1%EF%BC%8C%E5%85%B6%E4%BD%99%E4%BD%8D%E4%B8%BA%E9%9B%B6%EF%BC%8C%E6%AD%A4%E6%95%B0%E4%B8%8EX%E8%BF%9B%E8%A1%8C%E2%80%9C%E4%B8%8E%E8%BF%90%E7%AE%97%E2%80%9D%E5%8F%AF%E4%BB%A5%E5%BE%97%E5%88%B0X%E4%B8%AD%E7%9A%84%E6%8C%87%E5%AE%9A%E4%BD%8D%E3%80%82%0A%20%20%20%E4%BE%8B%EF%BC%9A%E8%AE%BEX%3D10101110%EF%BC%8C%0A%20%20%20%E5%8F%96X%E7%9A%84%E4%BD%8E4%E4%BD%8D%EF%BC%8C%E7%94%A8%20X%20%26%200000%201111%20%3D%200000%201110%C2%A0%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0%EF%BC%9B%0A%20%20%20%E8%BF%98%E5%8F%AF%E7%94%A8%E6%9D%A5%E5%8F%96X%E7%9A%842%E3%80%814%E3%80%816%E4%BD%8D%E3%80%82%0A2.%20%E4%BD%8D%E5%9F%9F%0A%E6%8B%93%E5%B1%95%EF%BC%9A%E5%8F%8C%E6%84%9F%E5%8F%B9%E5%8F%B7%EF%BC%88%EF%BC%81%EF%BC%81%EF%BC%89%0A%E5%9B%A0%E4%B8%BAC%E8%AF%AD%E8%A8%80%E4%B8%AD%EF%BC%8C%E6%89%80%E6%9C%89%E9%9D%9E0%E5%80%BC%E9%83%BD%E8%A1%A8%E7%A4%BA%E2%80%9C%E7%9C%9F%E2%80%9D%E3%80%82%E6%89%80%E4%BB%A5!%E9%9D%9E0%E5%80%BC%20%3D%200%EF%BC%8C%E8%80%8C!0%20%3D%201%E3%80%82%E5%8F%8C%E6%84%9F%E5%8F%B9%E5%8F%B7!!%E4%BD%9C%E7%94%A8%E5%B0%B1%E6%98%AF%E9%9D%9E0%E5%80%BC%E8%BD%AC%E6%88%901%EF%BC%8C%E8%80%8C0%E5%80%BC%E8%BF%98%E6%98%AF0.%E5%8F%8C%E6%84%9F%E5%8F%B9%E5%8F%B7!!%E6%98%AF%E4%B8%BA%E4%BA%86%E6%8A%8A%22%E9%9D%9E0%E5%80%BC%22%E8%BD%AC%E6%8D%A2%E6%88%901%EF%BC%8C%E8%80%8C0%E5%80%BC%E8%BF%98%E6%98%AF0%E3%80%82!!%E4%B8%8D%E9%9A%BE%E7%90%86%E8%A7%A3%EF%BC%8C%E4%B8%BE%E4%BE%8B%EF%BC%9A%0A!!(expression)%20%E7%AD%89%E4%BB%B7%E4%BA%8E!(!expression)%E3%80%82%E5%A6%82%E6%9E%9Cexpress%E6%98%AF%E4%B8%80%E4%B8%AA%E6%8C%87%E9%92%88%EF%BC%8C%E6%9C%80%E7%BB%88%E7%BB%93%E6%9E%9C%E5%B0%B1%E6%98%AF1.%E8%BF%99%E6%A0%B7!!(expression)%E5%8F%AF%E4%BB%A5%E7%BB%99bool%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC%E4%BA%86%E3%80%82%0A%0A%E5%A6%82%E6%9E%9C%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BB%93%E6%9E%84%E4%B8%AD%E5%8C%85%E5%90%AB%E5%A4%9A%E4%B8%AA%E5%BC%80%E5%85%B3%E9%87%8F%EF%BC%8C%E5%8F%AA%E6%9C%89%20TRUE%2FFALSE%20%E5%8F%98%E9%87%8F%EF%BC%8C%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%60%60%60%0Astruct%0A%7B%0A%20%20unsigned%20int%20widthValidated%3B%0A%20%20unsigned%20int%20heightValidated%3B%0A%7D%20status%3B%0A%60%60%60%0A%E8%BF%99%E7%A7%8D%E7%BB%93%E6%9E%84%E9%9C%80%E8%A6%81%208%20%E5%AD%97%E8%8A%82%E7%9A%84%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%EF%BC%8C%E4%BD%86%E5%9C%A8%E5%AE%9E%E9%99%85%E4%B8%8A%EF%BC%8C%E5%9C%A8%E6%AF%8F%E4%B8%AA%E5%8F%98%E9%87%8F%E4%B8%AD%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AA%E5%AD%98%E5%82%A8%200%20%E6%88%96%201%E3%80%82%E5%9C%A8%E8%BF%99%E7%A7%8D%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8CC%20%E8%AF%AD%E8%A8%80%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E7%A7%8D%E6%9B%B4%E5%A5%BD%E7%9A%84%E5%88%A9%E7%94%A8%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E7%9A%84%E6%96%B9%E5%BC%8F%E3%80%82%E5%A6%82%E6%9E%9C%E6%82%A8%E5%9C%A8%E7%BB%93%E6%9E%84%E5%86%85%E4%BD%BF%E7%94%A8%E8%BF%99%E6%A0%B7%E7%9A%84%E5%8F%98%E9%87%8F%EF%BC%8C%E6%82%A8%E5%8F%AF%E4%BB%A5%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F%E7%9A%84%E5%AE%BD%E5%BA%A6%E6%9D%A5%E5%91%8A%E8%AF%89%E7%BC%96%E8%AF%91%E5%99%A8%EF%BC%8C%E6%82%A8%E5%B0%86%E5%8F%AA%E4%BD%BF%E7%94%A8%E8%BF%99%E4%BA%9B%E5%AD%97%E8%8A%82%E3%80%82%E4%BE%8B%E5%A6%82%EF%BC%8C%E4%B8%8A%E9%9D%A2%E7%9A%84%E7%BB%93%E6%9E%84%E5%8F%AF%E4%BB%A5%E9%87%8D%E5%86%99%E6%88%90%EF%BC%9A%0Astruct%0A%7B%0A%20%20unsigned%20int%20widthValidated%20%3A%201%3B%0A%20%20unsigned%20int%20heightValidated%20%3A%201%3B%0A%7D%20status%3B%0A%0A%E5%9C%A8%E7%BB%93%E6%9E%84%E5%86%85%E5%A3%B0%E6%98%8E%E4%BD%8D%E5%9F%9F%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%A6%82%E4%B8%8B%EF%BC%9A%0Astruct%0A%7B%0A%20%20type%20%5Bmember_name%5D%20%3A%20width%20%3B%0A%7D%3B%0A%0A%7C%20%E5%85%83%E7%B4%A0%20%7C%20%20%E6%8F%8F%E8%BF%B0%20%7C%0A%7C%20---%20%7C%20---%20%7C%0A%7C%20type%20%7C%20%E6%95%B4%E6%95%B0%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%86%B3%E5%AE%9A%E4%BA%86%E5%A6%82%E4%BD%95%E8%A7%A3%E9%87%8A%E4%BD%8D%E5%9F%9F%E7%9A%84%E5%80%BC%E3%80%82%E7%B1%BB%E5%9E%8B%E5%8F%AF%E4%BB%A5%E6%98%AF%E6%95%B4%E5%9E%8B%E3%80%81%E6%9C%89%E7%AC%A6%E5%8F%B7%E6%95%B4%E5%9E%8B%E3%80%81%E6%97%A0%E7%AC%A6%E5%8F%B7%E6%95%B4%E5%9E%8B%E3%80%82%20%7C%0A%7C%20member_name%20%7C%20%20%E4%BD%8D%E5%9F%9F%E7%9A%84%E5%90%8D%E7%A7%B0%E3%80%82%7C%0A%7C%20width%20%7C%20%E4%BD%8D%E5%9F%9F%E4%B8%AD%E4%BD%8D%E7%9A%84%E6%95%B0%E9%87%8F%E3%80%82%E5%AE%BD%E5%BA%A6%E5%BF%85%E9%A1%BB%E5%B0%8F%E4%BA%8E%E6%88%96%E7%AD%89%E4%BA%8E%E6%8C%87%E5%AE%9A%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%BD%8D%E5%AE%BD%E5%BA%A6%E3%80%82%20%7C%0A%E5%B8%A6%E6%9C%89%E9%A2%84%E5%AE%9A%E4%B9%89%E5%AE%BD%E5%BA%A6%E7%9A%84%E5%8F%98%E9%87%8F%E8%A2%AB%E7%A7%B0%E4%B8%BA%E4%BD%8D%E5%9F%9F%E3%80%82%E4%BD%8D%E5%9F%9F%E5%8F%AF%E4%BB%A5%E5%AD%98%E5%82%A8%E5%A4%9A%E4%BA%8E%201%20%E4%BD%8D%E7%9A%84%E6%95%B0%EF%BC%8C%E4%BE%8B%E5%A6%82%EF%BC%8C%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA%E5%8F%98%E9%87%8F%E6%9D%A5%E5%AD%98%E5%82%A8%E4%BB%8E%200%20%E5%88%B0%207%20%E7%9A%84%E5%80%BC%EF%BC%8C%E6%82%A8%E5%8F%AF%E4%BB%A5%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E5%AE%BD%E5%BA%A6%E4%B8%BA%203%20%E4%BD%8D%E7%9A%84%E4%BD%8D%E5%9F%9F%EF%BC%8C%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%60%60%60%0Astruct%0A%7B%0A%20%20unsigned%20int%20age%20%3A%203%3B%0A%7D%20Age%3B%0A%60%60%60%0A%0A%23%23%23%23%23%202.3%20ISA_MASK%0A%0A0x%200000%20000f%20ffff%20fff8%20ULL%0A!%5B2f724d1b8e30df562be67cec33c664f0.png%5D(evernotecid%3A%2F%2FCFE27DEA-507B-4F51-A112-35468FF833F4%2Fappyinxiangcom%2F21790515%2FENResource%2Fp3140)%0Aisa%E6%8C%87%E9%92%88%E4%B8%8D%E5%8D%95%E5%8D%95%E5%8F%AA%E5%AD%98%E5%82%A8%E4%BA%86Class%E6%88%96Meta-Class%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%8C%E8%80%8C%E6%98%AF%E4%BD%BF%E7%94%A8%E5%85%B1%E7%94%A8%E4%BD%93%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AD%98%E5%82%A8%E4%BA%86%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%85%B6%E4%B8%ADshiftcls%E5%AD%98%E5%82%A8%E4%BA%86Class%E6%88%96Meta-Class%E7%9A%84%E5%9C%B0%E5%9D%80%EF%BC%8C%E9%9C%80%E8%A6%81%E5%90%8CISA_MASK%E8%BF%9B%E8%A1%8C%E6%8C%89%E4%BD%8D%26%E8%BF%90%E7%AE%97%E6%89%8D%E5%8F%AF%E4%BB%A5%E5%8F%96%E5%87%BA%E5%85%B6%E5%86%85%E5%AD%98%E5%9C%B0%E5%9D%80%E5%80%BC%E3%80%82%0A%0A%23%23%23%23%23%202.4%20%E4%BD%8D%E8%BF%90%E7%AE%97%E5%9C%A8%E6%9E%9A%E4%B8%BE%E4%B8%AD%E7%9A%84%E8%BF%90%E7%94%A8%0A%0A!%5Be2b170b0f3d66d9283ac6740ce7d9e6a.png%5D(evernotecid%3A%2F%2FCFE27DEA-507B-4F51-A112-35468FF833F4%2Fappyinxiangcom%2F21790515%2FENResource%2Fp3142)%0A!%5Bd19de5361dc51921e5dd6c15d424ad6a.png%5D(evernotecid%3A%2F%2FCFE27DEA-507B-4F51-A112-35468FF833F4%2Fappyinxiangcom%2F21790515%2FENResource%2Fp3143)%0A!%5B7d28a22976aafe9908ae85fb2c082fb6.png%5D(evernotecid%3A%2F%2FCFE27DEA-507B-4F51-A112-35468FF833F4%2Fappyinxiangcom%2F21790515%2FENResource%2Fp3144)%0A%0A%23%23%23%23%23%202.5%20%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BC%96%E7%A0%81%0A%0AiOS%E4%B8%AD%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E4%B8%AA%E5%8F%AB%E5%81%9A%40encode%E7%9A%84%E6%8C%87%E4%BB%A4%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%B0%86%E5%85%B7%E4%BD%93%E7%9A%84%E7%B1%BB%E5%9E%8B%E8%A1%A8%E7%A4%BA%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BC%96%E7%A0%81%0A%0A!%5Beae2b4ec4bc35ee0c4e0ee7b244af246.png%5D(evernotecid%3A%2F%2FCFE27DEA-507B-4F51-A112-35468FF833F4%2Fappyinxiangcom%2F21790515%2FENResource%2Fp3145)%0A%0A%23%23%23%23%23%202.6%20%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98%0Aoc%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8%EF%BC%9A%E6%A0%B9%E6%8D%AEisa%E6%8C%87%E9%92%88%E6%89%BE%E5%88%B0%E7%B1%BB%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95%E5%88%97%E8%A1%A8%EF%BC%8C%E8%8B%A5%E6%89%BE%E5%88%B0%EF%BC%8C%E5%88%99%E5%BC%80%E5%A7%8B%E8%B0%83%E7%94%A8%E3%80%82%E8%8B%A5%E6%9C%AA%E6%89%BE%E5%88%B0%EF%BC%8C%E5%88%99%E6%A0%B9%E6%8D%AEsuprerClass%E6%8C%87%E9%92%88%E6%89%BE%E5%88%B0%E7%88%B6%E7%B1%BB%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95%E5%88%97%E8%A1%A8%EF%BC%8C%E5%BC%80%E5%A7%8B%E8%B0%83%E7%94%A8%EF%BC%8C%E4%BB%A5%E6%AD%A4%E7%B1%BB%E6%8E%A8%E3%80%82%0A%0AClass%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84%E4%B8%AD%E6%9C%89%E4%B8%AA%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98%EF%BC%88cache_t%EF%BC%89%EF%BC%8C%E7%94%A8%E6%95%A3%E5%88%97%E8%A1%A8%EF%BC%88%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%89%E6%9D%A5%E7%BC%93%E5%AD%98%E6%9B%BE%E7%BB%8F%E8%B0%83%E7%94%A8%E8%BF%87%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8F%90%E9%AB%98%E6%96%B9%E6%B3%95%E7%9A%84%E6%9F%A5%E6%89%BE%E9%80%9F%E5%BA%A6%E3%80%82%0A1%E3%80%81%E6%95%A3%E5%88%97%E8%A1%A8%0A%E6%95%A3%E5%88%97%E8%A1%A8%EF%BC%88Hash%20table%EF%BC%8C%E4%B9%9F%E5%8F%AB%E5%93%88%E5%B8%8C%E8%A1%A8)%2C%20%E6%98%AF%E6%A0%B9%E6%8D%AE%E5%85%B3%E9%94%AE%E7%A0%81%E5%80%BC(Key%20value)%E8%80%8C%E7%9B%B4%E6%8E%A5%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%82%E4%B9%9F%E5%B0%B1%E6%98%AF%E8%AF%B4%EF%BC%8C%E5%AE%83%E9%80%9A%E8%BF%87%E6%8A%8A%E5%85%B3%E9%94%AE%E7%A0%81%E5%80%BC%E6%98%A0%E5%B0%84%E5%88%B0%E8%A1%A8%E4%B8%AD%E4%B8%80%E4%B8%AA%E4%BD%8D%E7%BD%AE%E6%9D%A5%E8%AE%BF%E9%97%AE%E8%AE%B0%E5%BD%95%2C%E4%BB%A5%E5%8A%A0%E5%BF%AB%E6%9F%A5%E6%89%BE%E7%9A%84%E9%80%9F%E5%BA%A6%E3%80%82%E8%BF%99%E4%B8%AA%E6%98%A0%E5%B0%84%E5%87%BD%E6%95%B0%E5%8F%AB%E5%81%9A%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B0%2C%E5%AD%98%E6%94%BE%E8%AE%B0%E5%BD%95%E7%9A%84%E6%95%B0%E7%BB%84%E5%8F%AB%E5%81%9A%E6%95%A3%E5%88%97%E8%A1%A8%E3%80%82%0A2%E3%80%81OC%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98%0A!%5B87b76fc8a8bb8bb625aeca959e3e2897.png%5D(evernotecid%3A%2F%2FCFE27DEA-507B-4F51-A112-35468FF833F4%2Fappyinxiangcom%2F21790515%2FENResource%2Fp3146)%0A!%5B0e01edfd1ebb33b821422a0b7cde64cc.png%5D(evernotecid%3A%2F%2FCFE27DEA-507B-4F51-A112-35468FF833F4%2Fappyinxiangcom%2F21790515%2FENResource%2Fp3147)%0A3%E3%80%81%E6%95%A3%E5%88%97%E8%A1%A8%E5%8E%9F%E7%90%86%0A%E9%A6%96%E5%85%88%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E7%A9%BA%E7%9A%84%E6%95%B0%E7%BB%84%E5%A6%82%E4%B8%8B%E5%9B%BE%3A%0A!%5B15dd397b4f31f2ffb3d4b219059f05f2.png%5D(evernotecid%3A%2F%2FCFE27DEA-507B-4F51-A112-35468FF833F4%2Fappyinxiangcom%2F21790515%2FENResource%2Fp3148)%0A%60%60%60%0A%E6%AF%94%E5%A6%82%E6%88%91%E4%BB%AC%E6%9C%89%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%0A-%20(void)cacheMethd%20%7B%0A%7D%0A%0Akey%20%3D%20%40selector(cacheMethd)%20%2F%2F%20%E6%96%B9%E6%B3%95%E5%90%8D%0A_mask%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%20%E5%B8%B8%E9%87%8F%0Aindex%20%3D%20%40selector(cacheMethd)%20%26%20_mask%3B%0A%E7%AE%97%E5%87%BA%E6%9D%A5%E6%AF%94%E5%A6%82%E8%AF%B4index%20%3D%202%0A%E5%AD%98%E5%8F%96%E6%95%B0%E6%8D%AE%E9%83%BD%E6%98%AF%E9%80%9A%E8%BF%87%E7%AE%97%E5%87%BA%E6%95%B0%E7%BB%84%E4%B8%8B%E6%A0%87%20%20%E6%9D%A5%E5%AD%98%E5%82%A8%E6%88%96%E8%80%85%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%0A%60%60%60%0A!%5Be75a81c8f1439198e49206de326b9505.png%5D(evernotecid%3A%2F%2FCFE27DEA-507B-4F51-A112-35468FF833F4%2Fappyinxiangcom%2F21790515%2FENResource%2Fp3149)%0A*%20%E5%93%88%E5%B8%8C%E5%86%B2%E7%AA%81%0A%60%60%60%0A%2F%2F%20%E5%AD%98%E6%95%B0%E6%8D%AE%0A%E5%A6%82%E6%9E%9Cindex%20%3D%20%40selector(cacheMethd)%20%26%20_mask%3B%0A%E7%AE%97%E5%87%BA%E6%9D%A5%E7%9A%84index%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E6%95%B0%E6%8D%AE%0A%0Awhile(bucket%5Bindex%5D)%20%7B%0A%20%20%20%20%20%20%20index%20--%3B%0A%20%20%20%20%20%20%20if(index%20%3C%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20index%20%3D%20%E6%95%B0%E7%BB%84count%20-%201%3B%0A%20%20%20%20%20%20%20%20%7D%0A%7D%0A%0A%2F%2F%20%E5%8F%96%E6%95%B0%E6%8D%AE%0A%E7%AE%97%E5%87%BAindex%20%3D%20%40selector(cacheMethd)%20%26%20_mask%3B%0A%E5%8F%96%E5%87%BAbucket_t%0A%0A%E5%AF%B9%E6%AF%94key%E6%98%AF%E5%90%A6%E7%9B%B8%E7%AD%89%0A%E7%9B%B8%E7%AD%89%E7%9B%B4%E6%8E%A5%E8%BF%94%E5%9B%9E%0A%E4%B8%8D%E7%AD%89%0Awhile(bucket%5Bindex%5D)%20%7B%0A%20%20%20%20%20%20%20index%20--%3B%0A%20%20%20%20%20%20%20if(index%20%3C%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20index%20%3D%20%E6%95%B0%E7%BB%84count%20-%201%3B%0A%20%20%20%20%20%20%20%20%7D%0A%7D%0A%E7%BB%A7%E7%BB%AD%E5%88%A4%E6%96%AD%0A%0A%60%60%60</center></body></html>